### Авторизация

```
const qilinFrameHelper = qilinGameFrame(
  gameUid: string,
  authUrl: string,
  onAuth?: (url: string, meta: any) => Promise
);
```

Создаем объект-хэлпер внутри тега script в iframe с игрой.
Где `gameUid` - уникальный `uid` игры в базе `qilin`,
`authUrl` - адрес сервера авторизации `qilin`,
а `onAuth` - функция авторизации, опциональный параметр. Если передается, то используется для авторизации. Если нет, то для авторизации используется функция по умолчанию, которая обращается к бэкенду `qilin` и возвращает промисс, который резолвится в объект вида:

```
interface responce {
  code: number;
  meta: any;
}
```
Где `code` код ответа от сервера, а `meta` - метаинформация, которая будет передана в игру после инициализации.

Для запуска авторизации вызываем метод `init` у объекта-хэлпера.

```
qilinFrameHelper.init()
  .then((meta: any) => {
    ... Код игры
  })
```

### Биллинг

Для вызова платежной формы необходимо вызвать метод `showPaymentForm` у объекта-хэлпера

```
qilinFrameHelper.showPaymentForm(itemId, userId);
```

После этого, данные вместе с `gameUid` будут с помощью `postMessage` отправлены в окно, открывшее iframe, и далее сервер-то-сервер обработка биллинга.

После того, как платежная форма закроется, в окно игры также с помощью `postMessage` отправляется событие со статусом операции. `true` - успешно,`false` - отмена или ошибка при проведении операции.

После получения события, объект-хэлпер вызовет колбеки, которые будут повешены на закрытие платежной формы.

```
const callback = (status: boolean) => {
  ...Запрос у сервера обновленного состояния
};

qilinFrameHelper.addCallback('PAYMENT_FORM_CLOSED', callback);
```
